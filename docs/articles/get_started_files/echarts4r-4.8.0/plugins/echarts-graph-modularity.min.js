!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("echarts")):"function"==typeof define&&define.amd?define(["echarts"],n):"object"==typeof exports?exports["echarts-graph-modularity"]=n(require("echarts")):t["echarts-graph-modularity"]=n(t.echarts)}(this,function(t){return function(t){function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var e={};return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=0)}([function(t,n,e){t.exports=e(1)},function(t,n,e){function o(t){return function(n,e){var o={};n.eachSeriesByType(t,function(t){if(t.get("modularity")){var n=t.getGraph(),e={},r=s();n.data.each(function(t){var o=n.getNodeByIndex(t);return e[o.id]=t,r.addNode(o.id),o.id}),n.edgeData.each("value",function(t,e){var o=n.getEdgeByIndex(e);return r.addLink(o.node1.id,o.node2.id),{source:o.node1.id,target:o.node2.id,value:t}});var u=new i(t.get("modularity.resolution")||1),c=u.execute(r),h={};for(var a in c){var d=c[a];h[d]=h[d]||0,h[d]++}var f=Object.keys(h);t.get("modularity.sort")&&f.sort(function(t,n){return n-t});var g={};f.forEach(function(n){g[n]=t.getColorFromPalette(n,o)});for(var a in c){var d=c[a];n.data.setItemVisual(e[a],"color",g[d])}n.edgeData.each(function(t){var e=n.edgeData.getItemModel(t),o=n.getEdgeByIndex(t),i=e.get("lineStyle.normal.color");switch(i){case"source":i=o.node1.getVisual("color");break;case"target":i=o.node2.getVisual("color")}null!=i&&o.setVisual("color",i)})}})}}var i=e(2),r=e(9),s=e(10);r.registerVisual(r.PRIORITY.VISUAL.CHART+1,o("graph")),r.registerVisual(r.PRIORITY.VISUAL.CHART+1,o("graphGL"))},function(t,n,e){function o(t,n){this.isRandomized=!1,this.useWeight=n,this.resolution=t||1,this.structure=null}var i=e(3),r=e(6);o.prototype.execute=function(t){this.structure=new i(t,this.useWeight);var n=new Array(t.getNodesCount()),e=(this.computeModularity(t,this.structure,n,this.resolution,this.isRandomized,this.useWeight),{});return this.structure.map.forEach(function(t,o){e[o]=n[t]}),e},o.prototype.computeModularity=function(t,n,e,o,i,r){for(var s=(n.graphWeightSum,n.weights.slice(),Object.create(null)),u=!0;u;){u=!1;for(var c=!0;c;){c=!1;var h=0;i&&(h=function(t,n){return Math.floor(Math.random()*(n-t))+t}(0,n.N));for(var a=0,d=h;a<n.N;d=(d+1)%n.N){a++;var f=this.updateBestCommunity(n,d,o);n.nodeCommunities[d]!=f&&null!=f&&(n.moveNodeTo(d,f),c=!0)}u=c||u}u&&n.zoomOut()}return this.fillComStructure(t,n,e),s},o.prototype.updateBestCommunity=function(t,n,e){var o=this.q(n,t.nodeCommunities[n],t,e),i=t.nodeCommunities[n];return t.nodeConnectionsWeight[n].forEach(function(r,s){var u=this.q(n,s,t,e);u>o&&(o=u,i=s)},this),i},o.prototype.fillComStructure=function(t,n,e){var o=0;return n.communities.forEach(function(t){t.nodes.forEach(function(t){n.invMap.get(t).nodes.forEach(function(t){e[t]=o})}),o++}),e},o.prototype.fillDegreeCount=function(t,n,e,o,i){var s=new Array(n.communities.length),u=r.degree(t);return t.forEachNode(function(t){var r=n.map.get(t);s[e[r]]+=i?o[r]:u[t.id]}),s},o.prototype._finalQ=function(t,n,e,o,i,r,s){throw new Error("not implemented properly")},o.prototype.q=function(t,n,e,o){var i=e.nodeConnectionsWeight[t].get(n),r=0;null!=i&&(r=i);var s=n.weightSum,u=e.weights[t],c=o*r-u*s/(2*e.graphWeightSum);return e.nodeCommunities[t]==n&&e.nodeCommunities[t].size()>1&&(c=o*r-u*(s-u)/(2*e.graphWeightSum)),e.nodeCommunities[t]==n&&1==e.nodeCommunities[t].size()&&(c=0),c},t.exports=o},function(t,n,e){"use strict";function o(t,n){this.N=t.getNodesCount(),this.graphWeightSum=0,this.structure=this,this.invMap=new Map,this.nodeConnectionsWeight=new Array(this.N),this.nodeConnectionsCount=new Array(this.N),this.nodeCommunities=new Array(this.N),this.map=new Map,this.topology=new Array(this.N);for(var e=0;e<this.N;e++)this.topology[e]=[];this.communities=[],this.weights=new Array(this.N);var o=0;t.forEachNode(function(t){this.map.set(t.id,o),this.nodeCommunities[o]=new i(this),this.nodeConnectionsWeight[o]=new Map,this.nodeConnectionsCount[o]=new Map,this.weights[o]=0,this.nodeCommunities[o].seed(o);var n=new i(this);n.nodes.add(o),this.invMap.set(o,n),this.communities.push(this.nodeCommunities[o]),o++}.bind(this)),t.forEachLink(function(t){var e=this.map.get(t.fromId),o=this.map.get(t.toId),i=1;e!==o&&(n&&(i=t.data.weight),this.setUpLink(e,o,i),this.setUpLink(o,e,i))}.bind(this)),this.graphWeightSum/=2}var i=e(4),r=e(5);o.prototype.setUpLink=function(t,n,e){this.weights[t]+=e;var o=new r(t,n,e);this.topology[t].push(o);var i=this.nodeCommunities[n];this.nodeConnectionsWeight[t].set(i,e),this.nodeConnectionsCount[t].set(i,1),this.nodeCommunities[t].connectionsWeight.set(i,e),this.nodeCommunities[t].connectionsCount.set(i,1),this.nodeConnectionsWeight[n].set(this.nodeCommunities[t],e),this.nodeConnectionsCount[n].set(this.nodeCommunities[t],1),this.nodeCommunities[n].connectionsWeight.set(this.nodeCommunities[t],e),this.nodeCommunities[n].connectionsCount.set(this.nodeCommunities[t],1),this.graphWeightSum+=e},o.prototype.addNodeTo=function(t,n){n.add(t),this.nodeCommunities[t]=n;var e=this.topology[t];for(var o in e){var i=e[o],r=i.target,s=this.nodeConnectionsWeight[r].get(n);void 0===s?this.nodeConnectionsWeight[r].set(n,i.weight):this.nodeConnectionsWeight[r].set(n,s+i.weight);var u=this.nodeConnectionsCount[r].get(n);void 0===u?this.nodeConnectionsCount[r].set(n,1):this.nodeConnectionsCount[r].set(n,u+1);var c=this.nodeCommunities[r],h=c.connectionsWeight.get(n);void 0===h?c.connectionsWeight.set(n,i.weight):c.connectionsWeight.set(n,h+i.weight);var a=c.connectionsCount.get(n);void 0===a?c.connectionsCount.set(n,1):c.connectionsCount.set(n,a+1);var d=this.nodeConnectionsWeight[t].get(c);void 0===d?this.nodeConnectionsWeight[t].set(c,i.weight):this.nodeConnectionsWeight[t].set(c,d+i.weight);var f=this.nodeConnectionsCount[t].get(c);if(void 0===f?this.nodeConnectionsCount[t].set(c,1):this.nodeConnectionsCount[t].set(c,f+1),n!=c){var g=n.connectionsWeight.get(c);void 0===g?n.connectionsWeight.set(c,i.weight):n.connectionsWeight.set(c,g+i.weight);var l=n.connectionsCount.get(c);void 0===l?n.connectionsCount.set(c,1):n.connectionsCount.set(c,l+1)}}},o.prototype.removeNodeFrom=function(t,n){var e=this.nodeCommunities[t],o=this.topology[t];for(var i in o){var r=o[i],s=r.target,u=this.nodeConnectionsWeight[s].get(e),c=this.nodeConnectionsCount[s].get(e);c-1==0?(this.nodeConnectionsWeight[s].delete(e),this.nodeConnectionsCount[s].delete(e)):(this.nodeConnectionsWeight[s].set(e,u-r.weight),this.nodeConnectionsCount[s].set(e,c-1));var h=this.nodeCommunities[s],a=h.connectionsWeight.get(e),d=h.connectionsCount.get(e);if(d-1==0?(h.connectionsWeight.delete(e),h.connectionsCount.delete(e)):(h.connectionsWeight.set(e,a-r.weight),h.connectionsCount.set(e,d-1)),t!=s){if(h!=e){var f=e.connectionsWeight.get(h),g=e.connectionsCount.get(h);g-1==0?(e.connectionsWeight.delete(h),e.connectionsCount.delete(h)):(e.connectionsWeight.set(h,f-r.weight),e.connectionsCount.set(h,g-1))}var l=this.nodeConnectionsWeight[t].get(h),p=this.nodeConnectionsCount[t].get(h);p-1==0?(this.nodeConnectionsWeight[t].delete(h),this.nodeConnectionsCount[t].delete(h)):(this.nodeConnectionsWeight[t].set(h,l-r.weight),this.nodeConnectionsCount[t].set(h,p-1))}}n.remove(t)},o.prototype.moveNodeTo=function(t,n){var e=this.nodeCommunities[t];this.removeNodeFrom(t,e),this.addNodeTo(t,n)},o.prototype.zoomOut=function(){var t=this.communities.reduce(function(t,n){return t.push(n),t},[]),n=t.length,e=new Array(n),o=0;this.nodeCommunities=new Array(n),this.nodeConnectionsWeight=new Array(n),this.nodeConnectionsCount=new Array(n);var s=new Map;t.forEach(function(n){var u=0;this.nodeConnectionsWeight[o]=new Map,this.nodeConnectionsCount[o]=new Map,e[o]=[],this.nodeCommunities[o]=new i(n);var c=new i(this.structure);n.nodes.forEach(function(t){this.invMap.get(t).nodes.forEach(c.nodes.add.bind(c.nodes))},this),s.set(o,c),n.connectionsWeight.forEach(function(n,i){var s=t.indexOf(i);if(~s){u+=s==o?2*n:n;var c=new r(o,s,n);e[o].push(c)}},this),this.weights[o]=u,this.nodeCommunities[o].seed(o),o++}.bind(this)),this.communities=[];for(var u=0;u<n;u++){var c=this.nodeCommunities[u];this.communities.push(c);for(var h in e[u]){var a=e[u][h];this.nodeConnectionsWeight[u].set(this.nodeCommunities[a.target],a.weight),this.nodeConnectionsCount[u].set(this.nodeCommunities[a.target],1),c.connectionsWeight.set(this.nodeCommunities[a.target],a.weight),c.connectionsCount.set(this.nodeCommunities[a.target],1)}}this.N=n,this.topology=e,this.invMap=s},t.exports=o},function(t,n){function e(t){this.structure=t.structure?t.structure:t,this.connectionsWeight=new Map,this.connectionsCount=new Map,this.nodes=new Set,this.weightSum=0}e.prototype.size=function(){return this.nodes.size},e.prototype.seed=function(t){this.nodes.add(t),this.weightSum+=this.structure.weights[t]},e.prototype.add=function(t){return this.nodes.add(t),this.weightSum+=this.structure.weights[t],!0},e.prototype.remove=function(t){var n=this.nodes.delete(t);if(this.weightSum-=this.structure.weights[t],!this.nodes.size){var e=this.structure.communities.indexOf(this);delete this.structure.communities[e]}return n},t.exports=e},function(t,n){function e(t,n,e){this.source=t,this.target=n,this.weight=e}t.exports=e},function(t,n,e){t.exports.degree=e(7),t.exports.betweenness=e(8)},function(t,n){function e(t,n){function e(n){var e=t.getLinks(n.id);u[n.id]=s(e,n.id)}var s,u=Object.create(null);if("both"===(n=(n||"both").toLowerCase())||"inout"===n)s=r;else if("in"===n)s=o;else{if("out"!==n)throw new Error("Expected centrality degree kind is: in, out or both");s=i}return t.forEachNode(e),u}function o(t,n){var e=0;if(!t)return e;for(var o=0;o<t.length;o+=1)e+=t[o].toId===n?1:0;return e}function i(t,n){var e=0;if(!t)return e;for(var o=0;o<t.length;o+=1)e+=t[o].fromId===n?1:0;return e}function r(t){return t?t.length:0}t.exports=e},function(t,n){function e(t,n){function e(t){p[t]/=2}function o(t){p[t.id]=0}function i(t){c=t.id,u(c),r()}function r(){for(t.forEachNode(s);a.length;){for(var n=a.pop(),e=(1+l[n])/g[n],o=d[n],i=0;i<o.length;++i){var r=o[i];l[r]+=g[r]*e}n!==c&&(p[n]+=l[n])}}function s(t){l[t.id]=0}function u(e){function o(t){r(t.id)}function i(t){var n=t.id;d[n]=[],f[n]=-1,g[n]=0}function r(t){-1===f[t]&&(f[t]=f[s]+1,h.push(t)),f[t]===f[s]+1&&(g[t]+=g[s],d[t].push(s))}for(t.forEachNode(i),f[e]=0,g[e]=1,h.push(e);h.length;){var s=h.shift();Object.create(null);a.push(s),t.forEachLinkedNode(s,o,n)}}var c,h=[],a=[],d=Object.create(null),f=Object.create(null),g=Object.create(null),l=Object.create(null),p=Object.create(null);return t.forEachNode(o),t.forEachNode(i),n||Object.keys(p).forEach(e),p}t.exports=e},function(n,e){n.exports=t},function(t,n,e){function o(t){function n(t,n){z.push({link:t,changeType:n})}function e(t,n){z.push({node:t,changeType:n})}function o(t,n){if(void 0===t)throw new Error("Invalid node identifier");R();var e=c(t);return e?q(e,"update"):(e=new r(t),S++,q(e,"add")),e.data=n,O[t]=e,V(),e}function c(t){return O[t]}function d(t){var n=c(t);if(!n)return!1;if(R(),n.links)for(;n.links.length;){var e=n.links[0];m(e)}return delete O[t],S--,q(n,"remove"),V(),!0}function f(t,n,e){R();var i=c(t)||o(t),r=c(n)||o(n),u=T(t,n,e);return j.push(u),s(i,u),t!==n&&s(r,u),U(u,"add"),V(),u}function g(t,n,e){return new u(t,n,e,h(t,n))}function l(t,n,e){var o=h(t,n),i=L.hasOwnProperty(o);if(i||v(t,n)){i||(L[o]=0);var r="@"+ ++L[o];o=h(t+r,n+r)}return new u(t,n,e,o)}function p(t){var n=c(t);return n?n.links:null}function m(t){if(!t)return!1;var n=i(t,j);if(n<0)return!1;R(),j.splice(n,1);var e=c(t.fromId),o=c(t.toId);return e&&(n=i(t,e.links))>=0&&e.links.splice(n,1),o&&(n=i(t,o.links))>=0&&o.links.splice(n,1),U(t,"remove"),V(),!0}function v(t,n){var e,o=c(t);if(!o||!o.links)return null;for(e=0;e<o.links.length;++e){var i=o.links[e];if(i.fromId===t&&i.toId===n)return i}return null}function C(){R(),A(function(t){d(t.id)}),V()}function w(t){var n,e;if("function"==typeof t)for(n=0,e=j.length;n<e;++n)t(j[n])}function y(t,n,e){var o=c(t);if(o&&o.links&&"function"==typeof n)return e?W(o.links,t,n):k(o.links,t,n)}function k(t,n,e){for(var o=0;o<t.length;++o){var i=t[o],r=i.fromId===n?i.toId:i.fromId;if(e(O[r],i))return!0}}function W(t,n,e){for(var o=0;o<t.length;++o){var i=t[o];if(i.fromId===n&&e(O[i.toId],i))return!0}}function b(){}function N(){M+=1}function x(){0===(M-=1)&&z.length>0&&(P.fire("changed",z),z.length=0)}function E(t){if("function"==typeof t)for(var n=Object.keys(O),e=0;e<n.length;++e)if(t(O[n[e]]))return!0}function I(t){if("function"==typeof t){var n;for(n in O)if(t(O[n]))return!0}}t=t||{},void 0===t.uniqueLinkId&&(t.uniqueLinkId=!0);var O="function"==typeof Object.create?Object.create(null):{},j=[],L={},S=0,M=0,A=function(){return Object.keys?E:I}(),T=t.uniqueLinkId?l:g,z=[],U=b,q=b,R=b,V=b,P={addNode:o,addLink:f,removeLink:m,removeNode:d,getNode:c,getNodesCount:function(){return S},getLinksCount:function(){return j.length},getLinks:p,forEachNode:A,forEachLinkedNode:y,forEachLink:w,beginUpdate:R,endUpdate:V,clear:C,hasLink:v,getLink:v};return a(P),function(){function t(){return P.beginUpdate=R=N,P.endUpdate=V=x,U=n,q=e,P.on=o,o.apply(P,arguments)}var o=P.on;P.on=t}(),P}function i(t,n){if(!n)return-1;if(n.indexOf)return n.indexOf(t);var e,o=n.length;for(e=0;e<o;e+=1)if(n[e]===t)return e;return-1}function r(t){this.id=t,this.links=null,this.data=null}function s(t,n){t.links?t.links.push(n):t.links=[n]}function u(t,n,e,o){this.fromId=t,this.toId=n,this.data=e,this.id=o}function c(t){var n,e,o,i=0;if(0==t.length)return i;for(n=0,o=t.length;n<o;n++)e=t.charCodeAt(n),i=(i<<5)-i+e,i|=0;return i}function h(t,n){return c(t.toString()+"ðŸ‘‰ "+n.toString())}t.exports=o;var a=e(11)},function(t,n){function e(t){var n=Object.create(null);return{on:function(e,o,i){if("function"!=typeof o)throw new Error("callback is expected to be a function");var r=n[e];return r||(r=n[e]=[]),r.push({callback:o,ctx:i}),t},off:function(e,o){if(void 0===e)return n=Object.create(null),t;if(n[e]){if("function"!=typeof o)delete n[e];else for(var i=n[e],r=0;r<i.length;++r)i[r].callback===o&&i.splice(r,1)}return t},fire:function(e){var o=n[e];if(!o)return t;var i;arguments.length>1&&(i=Array.prototype.splice.call(arguments,1));for(var r=0;r<o.length;++r){var s=o[r];s.callback.apply(s.ctx,i)}return t}}}function o(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var n=["on","fire","off"],e=0;e<n.length;++e)if(t.hasOwnProperty(n[e]))throw new Error("Subject cannot be eventified, since it already has property '"+n[e]+"'")}t.exports=function(t){o(t);var n=e(t);return t.on=n.on,t.off=n.off,t.fire=n.fire,t}}])});